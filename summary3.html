<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Summary of your coach-mentor training reflections</title>
<style>
  /* Load PolySans for browser display */
  @font-face {
    font-family: "PolySans";
    src: url("PolySans-Neutral.woff2") format("woff2"),
         url("PolySans-Neutral.woff") format("woff");
    font-weight: normal;
  }
  body {
    font-family: "PolySans", sans-serif;
    padding: 30px;
    max-width: 700px;
    margin: auto;
    font-size: 18px;
    line-height: 1.6;
  }
  textarea {
    width: 100%;
    height: 180px;
    font-family: "PolySans", sans-serif;
    font-size: 16px;
    padding: 12px;
    box-sizing: border-box;
    border: 1px solid #ccc;
    border-radius: 6px;
  }
  button {
    margin-top: 20px;
    padding: 12px 20px;
    font-size: 16px;
    font-family: "PolySans", sans-serif;
    cursor: pointer;
    border: none;
    border-radius: 6px;
    background-color: #0078ff;
    color: white;
  }
  .saved-note {
    margin-top: 10px;
    color: #008000;
    font-size: 14px;
  }
</style>
</head>
<body>

<h2>Your coach-mentor training reflections</h2>

<div class="summary" id="summaryDisplay"></div>

<button onclick="downloadPDF()">Download All Reflections as PDF</button>

<!-- jsPDF fonts and library -->
<script src="PolySans-normal.js"></script>
<script src="PolySans-bold.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
const totalReflections = 10;

// MANUAL TITLES ARRAY
const titles = [
  "The qualities that make me uniquely myself:",
  "Some strengths that exist in my community and how I might build on them:",
  "What I know about the things my players might be dealing with and how can I learn more:",
  "Some strategies I can use to make a connection with my players:",
  "My plan for creating a team code with my players:",
  "What I can do to create consistency:",
  "My techniques for checking myself:",
  "2 strategies I can use to uphold the team code:",
  "How I can transition at the end of the season:",
  "How I can give closure at the end of the season:",
];

// DISPLAY SUMMARY ON SCREEN
function showSummary() {
  const summaryEl = document.getElementById('summaryDisplay');
  let html = '';

  for (let i = 1; i <= totalReflections; i++) {
    const key = 'reflection' + i;
    const stored = localStorage.getItem(key);

    if (stored) {
      const title = titles[i - 1] || `Reflection ${i}`;
      html += `
        <div style="margin-bottom: 25px;">
          <div style="font-weight: bold; font-size: 20px; margin-bottom: 8px;">
            ${title}
          </div>
          <div style="white-space: pre-wrap;">
            ${stored}
          </div>
        </div>
      `;
    }
  }

  summaryEl.innerHTML = html || "No reflections saved yet.";
}

// DOWNLOAD PDF FUNCTION
<script>
async function downloadPDF() {
  const { jsPDF } = window.jspdf || {};
  if (!jsPDF) {
    alert("jsPDF library not loaded!");
    return;
  }

  // --- CONFIG ---
  const logoURL = "https://YOURDOMAIN.com/logo.png"; // replace with your logo
  const pageWidth = 612;   // Letter width in pts
  const pageHeight = 792;  // Letter height in pts
  const leftMargin = 40;
  const rightMargin = 40;
  const usableWidth = pageWidth - leftMargin - rightMargin;
  const lineHeight = 18;

  // Load logo as data URL
  let logoData = null;
  try {
    logoData = await new Promise((resolve, reject) => {
      const img = new Image();
      img.crossOrigin = "Anonymous";
      img.onload = () => {
        const canvas = document.createElement("canvas");
        canvas.width = img.width;
        canvas.height = img.height;
        canvas.getContext("2d").drawImage(img, 0, 0);
        resolve(canvas.toDataURL("image/png"));
      };
      img.onerror = reject;
      img.src = logoURL;
    });
  } catch(e) {
    console.warn("Logo could not be loaded, continuing without it.");
  }

  const doc = new jsPDF({ unit: "pt", format: "letter" });

  // Verify fonts are loaded
  if (!doc.getFontList().PolySans) {
    alert("PolySans font not registered! PDF will fail.");
    return;
  }

  let y = 40;

  // Add logo if loaded
  if (logoData) {
    doc.addImage(logoData, "PNG", leftMargin, y, 120, 120);
    y += 140;
  }

  // Add main header
  const header = "Your Reflections Summary";
  doc.setFont("PolySans", "bold");
  doc.setFontSize(22);
  const headerLines = doc.splitTextToSize(header || "", usableWidth);
  headerLines.forEach(line => {
    if (y > pageHeight - 50) { doc.addPage(); y = 40; }
    doc.text(line, leftMargin, y);
    y += lineHeight;
  });
  y += 20;

  // Loop through reflections
  for (let i = 1; i <= totalReflections; i++) {
    const key = "reflection" + i;
    const stored = localStorage.getItem(key);
    if (!stored) continue; // skip if missing

    const title = titles[i - 1] || `Reflection ${i}`;

    // Title in bold
    doc.setFont("PolySans", "bold");
    doc.setFontSize(16);
    const titleLines = doc.splitTextToSize(title || "", usableWidth);
    titleLines.forEach(line => {
      if (y > pageHeight - 50) { doc.addPage(); y = 40; }
      doc.text(line, leftMargin, y);
      y += lineHeight;
    });
    y += 8; // small spacing

    // Body text
    doc.setFont("PolySans", "normal");
    doc.setFontSize(12);
    const bodyLines = doc.splitTextToSize(stored || "", usableWidth);
    bodyLines.forEach(line => {
      if (y > pageHeight - 50) { doc.addPage(); y = 40; }
      doc.text(line, leftMargin, y);
      y += lineHeight;
    });
    y += 20; // spacing between reflections
  }

  doc.save("Reflections.pdf");
}

// SHOW SUMMARY ON PAGE LOAD
window.onload = showSummary;
</script>

</body>
</html>
