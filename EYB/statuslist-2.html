<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Summary of your reflections</title>
  <style>
    @font-face {
      font-family: "PolySans";
      src: url("PolySans-Neutral.woff2") format("woff2"),
           url("PolySans-Neutral.woff") format("woff");
    }

    body {
      font-family: "PolySans", sans-serif;
      padding: 30px;
      max-width: 800px;
      margin: auto;
      font-size: 18px;
      line-height: 1.6;
      background-color: #F3EBDD;
    }

    button {
      padding: 10px 16px;
      background: #1F3F59;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 12px;
    }

    #progressBar {
      margin-bottom: 25px;
      font-size: 18px;
    }

    .section {
      margin-bottom: 30px;
      background: white;
      border-radius: 8px;
      padding: 15px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .section-header h2 {
      margin: 0;
      font-size: 22px;
    }

    .reflection-item {
      padding: 12px 0;
      border-top: 1px solid #ddd;
    }

    .reflection-item:first-child {
      border-top: none;
    }

    .reflection-item h3 {
      margin: 0 0 6px 0;
      font-size: 18px;
    }

    .reflection-item p {
      margin: 0;
      white-space: pre-wrap;
    }

    .not-complete {
      font-style: italic;
      color: #666;
    }

    .section-footer {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 2px solid #eee;
    }
  </style>
</head>
<body>

<h1>Your Coach-Mentor Training Reflections</h1>

<div id="progressBar"></div>
  
  <button onclick="downloadPDF()" 
        style="margin: 20px 0; padding: 12px 18px; font-size: 16px;">
  Download your reflections as a PDF
</button>
  
<div id="summaryDisplay"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <script src="PolySans-normal.js"></script>
  <script src="PolySans-bold.js"></script>
  <script>
  if (window.jspdf && window.jspdf.jsPDF) {
    window.jspdf.jsPDF.API.events.forEach(([event, handler]) => {
      if (event === 'addFonts') handler.call(window.jspdf.jsPDF.API);
    });
  }
  </script>

<script>
const totalReflections = 15;

/* Titles shown WHEN COMPLETED */
const completedTitles = [
  "What being a coach-mentor means to me:",
  "A time someone showed they believed in me:",
  "How it felt:",
  "What I can do to show belief in my players:",
  "How my coaches coached me:",
  "My thoughts on Mulch's evolution:",
  "How my coaching has evolved since I started:",
  "An example of a mistake I needed to own:",
  "What I find challenging about owning mistakes:",
  "A time I didn't feel I belonged:",
  "A time I did feel I belonged:",
  "Strategies for addressing sideways behavior from Adrian and JT:",
  "Lessons from sport I've applied in other areas of my life:",
  "How I can help players connect what they learn with me to their lives outside soccer:",
  "How I can help players set goals for themselves:",
];

/* Titles shown WHEN NOT COMPLETED */
const pendingTitles = [
  "What does being a coach-mentor mean to you?",
  "Can you remember a time when someone showed they believed in you?",
  "How did it feel?",
  "What can you do to show belief in your players?",
  "How did your coaches coach you?",
  "Does Mulch’s reflection on his own journey resonate with you?",
  "How has your coaching evolved since you started?",
  "What’s an example of a mistake you made that you needed to own?",
  "What, if anything, do you find challening about owning mistakes?",
  "What’s an example of a time you didn’t feel like you belonged?",
  "What’s an example of a time you did feel like you belonged?",
  "What strategies for addressing sideways behavior did you notice?",
  "What lessons from sport have you transferred to other areas of life?",
  "How can you help players connect learning to life outside soccer?",
  "How can you help players set goals for themselves?",
  ];

/* Sections now include section-level reflection page */
const sections = [
  { title: "Part One: The Impact of a Coach", video: "vid2-1.html", startPage: "subreflection2-1.html", reflections: [1] },
  { title: "Part Two: Investing in Players", video: "vid2-2.html", startPage: "subreflection2-2.html", reflections: [2,3,4] },
  { title: "Part Three: Evolving as a Coach", video: "vid2-3.html", startPage: "subreflection2-3.html", reflections: [5,6,7] },
  { title: "Part Four: Owning Mistakes", video: "vid2-4.html", startPage: "subreflection2-4.html", reflections: [8,9] },
  { title: "Part Five: Empathy and Belonging", video: "vid2-5.html", startPage: "subreflection2-5.html", reflections: [10,11] },
  { title: "Part Six: Applying C.A.T.C.H.", video: "vid2-6.html", startPage: "subreflection2-6.html", reflections: [12] },
  { title: "Part Seven: S.M.A.R.T. Goals & Life Skills", video: "vid2-7.html", startPage: "subreflection2-7.html", reflections: [13,14,15] },
];

function updateProgressBar() {
  let completed = 0;
  for (let i = 1; i <= totalReflections; i++) {
    const v = localStorage.getItem("reflection2-" + i);
    if (v && v.trim()) completed++;
  }
  document.getElementById("progressBar").innerHTML =
    `<strong>${completed} of ${totalReflections} reflections completed</strong>`;
}

function showSummary() {
  updateProgressBar();
  let html = "";

  sections.forEach(section => {
    let sectionHasIncomplete = false;

    html += `<div class="section">`;
    html += `
      <div class="section-header">
        <h2>${section.title}</h2>
        <button onclick="location.href='${section.video}'">Revisit Video</button>
      </div>
    `;

    section.reflections.forEach(i => {
      const stored = localStorage.getItem("reflection2-" + i);
      const isComplete = stored && stored.trim();

      if (!isComplete) sectionHasIncomplete = true;

      html += `<div class="reflection-item">`;
      html += `<h3>${isComplete ? "✔︎ " + completedTitles[i-1] : "○ " + pendingTitles[i-1]}</h3>`;
      html += isComplete
        ? `<p>${stored}</p>`
        : `<p class="not-complete">Reflection not yet completed</p>`;
      html += `</div>`;
    });

    if (sectionHasIncomplete) {
      html += `
        <div class="section-footer">
          <button onclick="location.href='${section.startPage}'">
            Complete Reflections Now
          </button>
        </div>
      `;
    }

    html += `</div>`;
  });

  document.getElementById("summaryDisplay").innerHTML = html;
}

  async function downloadPDF() {
  const { jsPDF } = window.jspdf;

  // --- CONFIG ---
  const logoURL = "https://images.squarespace-cdn.com/content/5b1dd63f620b85685e2e9978/15782fbc-a9dc-4f5b-94f2-a6f9cf73c65a/Foundation-YC-lockup-sm.png"; 
  const pageWidth = 612;   // Letter size width in pt (8.5in * 72)
  const pageHeight = 792;  // Letter size height in pt (11in * 72)
  const leftMargin = 60;
  const rightMargin = 60;
  const usableWidth = pageWidth - leftMargin - rightMargin;
  const lineHeight = 18;

  // Load logo as data URL
  let logoData = null;
  try {
    logoData = await new Promise((resolve, reject) => {
      const img = new Image();
      img.crossOrigin = "Anonymous";
      img.onload = () => {
        const canvas = document.createElement("canvas");
        canvas.width = img.width;
        canvas.height = img.height;
        canvas.getContext("2d").drawImage(img, 0, 0);
        resolve(canvas.toDataURL("image/png"));
      };
      img.onerror = reject;
      img.src = logoURL;
    });
  } catch(e) {
    console.warn("Logo could not be loaded, continuing without it.");
  }

  // Create Letter size PDF
  const doc = new jsPDF({
    unit: "pt",
    format: "letter"
  });

  let y = 40; // start height

  // Add logo if loaded
  if (logoData) {
  const targetWidth = 180;
const scale = targetWidth / 354;

const renderWidth = 180;
const renderHeight = 105 * scale;

doc.addImage(logoData, "PNG", leftMargin, y, renderWidth, renderHeight);
y += renderHeight + 50;   // move down after logo
}
 
  // Add main header
  doc.setFont("PolySans", "bold");
  doc.setFontSize(22);

  // Wrap header text
  const header = "Your Reflections Summary";
  const headerLines = doc.splitTextToSize(header, usableWidth);
  headerLines.forEach(line => {
    if (y > pageHeight - 50) { doc.addPage(); y = 40; }
    doc.text(line, leftMargin, y);
    y += lineHeight;
  });
  y += 20;

  // --- Loop through reflections ---
  for (let i = 1; i <= totalReflections; i++) {
    const key = "reflection2-" + i;
    const stored = localStorage.getItem(key);
    if (!stored) continue;

    const title = titles[i - 1] || `Reflection ${i}`;

    // Add title in bold
    doc.setFont("PolySans", "bold");
    doc.setFontSize(16);
    const titleLines = doc.splitTextToSize(title, usableWidth);
    titleLines.forEach(line => {
      if (y > pageHeight - 50) { doc.addPage(); y = 40; }
      doc.text(line, leftMargin, y);
      y += lineHeight;
    });
    y += 8; // small spacing before body

    // Add body text
    doc.setFont("PolySans", "normal");
    doc.setFontSize(12);
    const wrapped = doc.splitTextToSize(stored, usableWidth);
    wrapped.forEach(line => {
      if (y > pageHeight - 50) { doc.addPage(); y = 40; }
      doc.text(line, leftMargin, y);
      y += lineHeight;
    });

    y += 20; // spacing between reflections
  }

  doc.save("Reflections.pdf");
}
  
window.onload = showSummary;
</script>

</body>
</html>
